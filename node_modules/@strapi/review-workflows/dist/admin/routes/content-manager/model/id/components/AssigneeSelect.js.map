{"version":3,"file":"AssigneeSelect.js","sources":["../../../../../../../admin/src/routes/content-manager/model/id/components/AssigneeSelect.tsx"],"sourcesContent":["import * as React from 'react';\n\nimport {\n  useNotification,\n  useAPIErrorHandler,\n  useRBAC,\n  useAdminUsers,\n  useQueryParams,\n} from '@strapi/admin/strapi-admin';\nimport { unstable_useDocument } from '@strapi/content-manager/strapi-admin';\nimport { Combobox, ComboboxOption, Field, VisuallyHidden } from '@strapi/design-system';\nimport { useIntl } from 'react-intl';\nimport { useParams } from 'react-router-dom';\n\nimport { useTypedSelector } from '../../../../../modules/hooks';\nimport { useUpdateAssigneeMutation } from '../../../../../services/content-manager';\nimport { buildValidParams } from '../../../../../utils/api';\nimport { getDisplayName } from '../../../../../utils/users';\n\nimport { ASSIGNEE_ATTRIBUTE_NAME } from './constants';\n\nconst AssigneeSelect = ({ isCompact }: { isCompact?: boolean }) => {\n  const {\n    collectionType = '',\n    id,\n    slug: model = '',\n  } = useParams<{ collectionType: string; slug: string; id: string }>();\n  const permissions = useTypedSelector((state) => state.admin_app.permissions);\n  const { formatMessage } = useIntl();\n  const { _unstableFormatAPIError: formatAPIError } = useAPIErrorHandler();\n  const { toggleNotification } = useNotification();\n  const {\n    allowedActions: { canRead },\n    isLoading: isLoadingPermissions,\n  } = useRBAC(permissions.settings?.users);\n  const [{ query }] = useQueryParams();\n  const params = React.useMemo(() => buildValidParams(query), [query]);\n  const {\n    data,\n    isLoading: isLoadingUsers,\n    isError,\n  } = useAdminUsers(undefined, {\n    skip: isLoadingPermissions || !canRead,\n  });\n  const { document } = unstable_useDocument(\n    {\n      collectionType,\n      model,\n      documentId: id,\n    },\n    {\n      skip: !id && collectionType !== 'single-types',\n    }\n  );\n\n  const users = data?.users || [];\n\n  const currentAssignee = document ? document[ASSIGNEE_ATTRIBUTE_NAME] : null;\n\n  const [updateAssignee, { error, isLoading: isMutating }] = useUpdateAssigneeMutation();\n\n  if (!collectionType || !model || !document?.documentId) {\n    return null;\n  }\n\n  const handleChange = async (assigneeId: string | null) => {\n    // a simple way to avoid erroneous updates\n    if (currentAssignee?.id === assigneeId) {\n      return;\n    }\n\n    const res = await updateAssignee({\n      slug: collectionType,\n      model,\n      id: document.documentId,\n      params,\n      data: {\n        id: assigneeId ? parseInt(assigneeId, 10) : null,\n      },\n    });\n\n    if ('data' in res) {\n      toggleNotification({\n        type: 'success',\n        message: formatMessage({\n          id: 'content-manager.reviewWorkflows.assignee.notification.saved',\n          defaultMessage: 'Assignee updated',\n        }),\n      });\n    }\n\n    if (isCompact && 'error' in res) {\n      toggleNotification({\n        type: 'danger',\n        message: formatAPIError(res.error),\n      });\n    }\n  };\n\n  const isDisabled =\n    (!isLoadingPermissions && !isLoadingUsers && users.length === 0) || !document.documentId;\n  const isLoading = isLoadingUsers || isLoadingPermissions || isMutating;\n\n  const assigneeLabel = formatMessage({\n    id: 'content-manager.reviewWorkflows.assignee.label',\n    defaultMessage: 'Assignee',\n  });\n  const assigneeClearLabel = formatMessage({\n    id: 'content-manager.reviewWorkflows.assignee.clear',\n    defaultMessage: 'Clear assignee',\n  });\n  const assigneePlaceholder = formatMessage({\n    id: 'content-manager.reviewWorkflows.assignee.placeholder',\n    defaultMessage: 'Selectâ€¦',\n  });\n\n  if (isCompact) {\n    return (\n      <Field.Root name={ASSIGNEE_ATTRIBUTE_NAME} id={ASSIGNEE_ATTRIBUTE_NAME}>\n        <VisuallyHidden>\n          <Field.Label>{assigneeLabel}</Field.Label>\n        </VisuallyHidden>\n        <Combobox\n          clearLabel={assigneeClearLabel}\n          disabled={isDisabled}\n          value={currentAssignee ? currentAssignee.id.toString() : null}\n          onChange={handleChange}\n          onClear={() => handleChange(null)}\n          placeholder={assigneePlaceholder}\n          loading={isLoading || isLoadingPermissions || isMutating}\n          size=\"S\"\n        >\n          {users.map((user) => {\n            return (\n              <ComboboxOption\n                key={user.id}\n                value={user.id.toString()}\n                textValue={getDisplayName(user)}\n              >\n                {getDisplayName(user)}\n              </ComboboxOption>\n            );\n          })}\n        </Combobox>\n      </Field.Root>\n    );\n  }\n\n  return (\n    <Field.Root\n      name={ASSIGNEE_ATTRIBUTE_NAME}\n      id={ASSIGNEE_ATTRIBUTE_NAME}\n      error={\n        ((isError &&\n          canRead &&\n          formatMessage({\n            id: 'content-manager.reviewWorkflows.assignee.error',\n            defaultMessage: 'An error occurred while fetching users',\n          })) ||\n          (error && formatAPIError(error))) ??\n        undefined\n      }\n    >\n      <Field.Label>{assigneeLabel}</Field.Label>\n      <Combobox\n        clearLabel={assigneeClearLabel}\n        disabled={\n          (!isLoadingPermissions && !isLoading && users.length === 0) || !document.documentId\n        }\n        value={currentAssignee ? currentAssignee.id.toString() : null}\n        onChange={handleChange}\n        onClear={() => handleChange(null)}\n        placeholder={assigneePlaceholder}\n        loading={isLoading || isLoadingPermissions || isMutating}\n      >\n        {users.map((user) => {\n          return (\n            <ComboboxOption\n              key={user.id}\n              value={user.id.toString()}\n              textValue={getDisplayName(user)}\n            >\n              {getDisplayName(user)}\n            </ComboboxOption>\n          );\n        })}\n      </Combobox>\n      <Field.Error />\n    </Field.Root>\n  );\n};\n\nexport { AssigneeSelect };\n"],"names":["AssigneeSelect","isCompact","collectionType","id","slug","model","useParams","permissions","useTypedSelector","state","admin_app","formatMessage","useIntl","_unstableFormatAPIError","formatAPIError","useAPIErrorHandler","toggleNotification","useNotification","allowedActions","canRead","isLoading","isLoadingPermissions","useRBAC","settings","users","query","useQueryParams","params","React","useMemo","buildValidParams","data","isLoadingUsers","isError","useAdminUsers","undefined","skip","document","unstable_useDocument","documentId","currentAssignee","ASSIGNEE_ATTRIBUTE_NAME","updateAssignee","error","isMutating","useUpdateAssigneeMutation","handleChange","assigneeId","res","parseInt","type","message","defaultMessage","isDisabled","length","assigneeLabel","assigneeClearLabel","assigneePlaceholder","_jsxs","Field","Root","name","_jsx","VisuallyHidden","Label","Combobox","clearLabel","disabled","value","toString","onChange","onClear","placeholder","loading","size","map","user","ComboboxOption","textValue","getDisplayName","Error"],"mappings":"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"}