{"version":3,"file":"useServerRestartWatcher.mjs","sources":["../../../../admin/src/components/DataManager/useServerRestartWatcher.ts"],"sourcesContent":["import { useFetchClient } from '@strapi/admin/strapi-admin';\n\nconst TIMEOUT = 'timeout';\n\nconst timeout = 30 * 1000;\n\nexport const useServerRestartWatcher = () => {\n  const { get } = useFetchClient();\n\n  const serverRestartWatcher = async (initTime?: number) => {\n    const startTime = initTime ?? Date.now();\n\n    if (Date.now() - startTime > timeout) {\n      throw new Error(TIMEOUT);\n    }\n\n    try {\n      const res = await get(`/content-type-builder/update-schema-status`);\n\n      if (res?.data?.data?.isUpdating === true) {\n        return new Promise((resolve) => {\n          setTimeout(() => {\n            return serverRestartWatcher(startTime).then(resolve);\n          }, 200);\n        });\n      }\n    } catch (err) {\n      return new Promise((resolve) => {\n        setTimeout(() => {\n          return serverRestartWatcher(startTime).then(resolve);\n        }, 200);\n      });\n    }\n  };\n\n  return serverRestartWatcher;\n};\n"],"names":["TIMEOUT","timeout","useServerRestartWatcher","get","useFetchClient","serverRestartWatcher","initTime","startTime","Date","now","Error","res","data","isUpdating","Promise","resolve","setTimeout","then","err"],"mappings":";;AAEA,MAAMA,OAAU,GAAA,SAAA;AAEhB,MAAMC,UAAU,EAAK,GAAA,IAAA;MAERC,uBAA0B,GAAA,IAAA;IACrC,MAAM,EAAEC,GAAG,EAAE,GAAGC,cAAAA,EAAAA;AAEhB,IAAA,MAAMC,uBAAuB,OAAOC,QAAAA,GAAAA;QAClC,MAAMC,SAAAA,GAAYD,QAAYE,IAAAA,IAAAA,CAAKC,GAAG,EAAA;AAEtC,QAAA,IAAID,IAAKC,CAAAA,GAAG,EAAKF,GAAAA,SAAAA,GAAYN,OAAS,EAAA;AACpC,YAAA,MAAM,IAAIS,KAAMV,CAAAA,OAAAA,CAAAA;AAClB;QAEA,IAAI;AACF,YAAA,MAAMW,GAAM,GAAA,MAAMR,GAAI,CAAA,CAAC,0CAA0C,CAAC,CAAA;AAElE,YAAA,IAAIQ,GAAKC,EAAAA,IAAAA,EAAMA,IAAMC,EAAAA,UAAAA,KAAe,IAAM,EAAA;gBACxC,OAAO,IAAIC,QAAQ,CAACC,OAAAA,GAAAA;oBAClBC,UAAW,CAAA,IAAA;wBACT,OAAOX,oBAAAA,CAAqBE,SAAWU,CAAAA,CAAAA,IAAI,CAACF,OAAAA,CAAAA;qBAC3C,EAAA,GAAA,CAAA;AACL,iBAAA,CAAA;AACF;AACF,SAAA,CAAE,OAAOG,GAAK,EAAA;YACZ,OAAO,IAAIJ,QAAQ,CAACC,OAAAA,GAAAA;gBAClBC,UAAW,CAAA,IAAA;oBACT,OAAOX,oBAAAA,CAAqBE,SAAWU,CAAAA,CAAAA,IAAI,CAACF,OAAAA,CAAAA;iBAC3C,EAAA,GAAA,CAAA;AACL,aAAA,CAAA;AACF;AACF,KAAA;IAEA,OAAOV,oBAAAA;AACT;;;;"}