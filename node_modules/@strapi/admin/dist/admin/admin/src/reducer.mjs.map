{"version":3,"file":"reducer.mjs","sources":["../../../../admin/src/reducer.ts"],"sourcesContent":["import { createSlice } from '@reduxjs/toolkit';\n\nimport { PermissionMap } from './types/permissions';\nimport { getCookieValue, setCookie, deleteCookie } from './utils/cookies';\n\nimport type { PayloadAction } from '@reduxjs/toolkit';\n\ntype ThemeName = 'light' | 'dark' | 'system';\n\ninterface AppState {\n  language: {\n    locale: string;\n    localeNames: Record<string, string>;\n  };\n  permissions: Partial<PermissionMap>;\n  theme: {\n    currentTheme: ThemeName;\n    availableThemes: string[];\n  };\n  token?: string | null;\n}\n\nconst STORAGE_KEYS = {\n  TOKEN: 'jwtToken',\n  STATUS: 'isLoggedIn',\n};\n\nconst THEME_LOCAL_STORAGE_KEY = 'STRAPI_THEME';\nconst LANGUAGE_LOCAL_STORAGE_KEY = 'strapi-admin-language';\n\nexport const getStoredToken = (): string | null => {\n  const fromLocalStorage = localStorage.getItem(STORAGE_KEYS.TOKEN);\n  if (fromLocalStorage) {\n    return JSON.parse(fromLocalStorage);\n  }\n\n  const fromCookie = getCookieValue(STORAGE_KEYS.TOKEN);\n  return fromCookie ?? null;\n};\n\nconst adminSlice = createSlice({\n  name: 'admin',\n  initialState: () => {\n    return {\n      language: {\n        locale: 'en',\n        localeNames: { en: 'English' },\n      },\n      permissions: {},\n      theme: {\n        availableThemes: [],\n        currentTheme: localStorage.getItem(THEME_LOCAL_STORAGE_KEY) || 'system',\n      },\n      token: null,\n    } as AppState;\n  },\n  reducers: {\n    setAppTheme(state, action: PayloadAction<ThemeName>) {\n      state.theme.currentTheme = action.payload;\n      window.localStorage.setItem(THEME_LOCAL_STORAGE_KEY, action.payload);\n    },\n    setAvailableThemes(state, action: PayloadAction<AppState['theme']['availableThemes']>) {\n      state.theme.availableThemes = action.payload;\n    },\n    setLocale(state, action: PayloadAction<string>) {\n      state.language.locale = action.payload;\n\n      window.localStorage.setItem(LANGUAGE_LOCAL_STORAGE_KEY, action.payload);\n      document.documentElement.setAttribute('lang', action.payload);\n    },\n    setToken(state, action: PayloadAction<string | null>) {\n      state.token = action.payload;\n    },\n    login(state, action: PayloadAction<{ token: string; persist?: boolean }>) {\n      const { token, persist } = action.payload;\n\n      if (!persist) {\n        setCookie(STORAGE_KEYS.TOKEN, token);\n      } else {\n        window.localStorage.setItem(STORAGE_KEYS.TOKEN, JSON.stringify(token));\n      }\n      window.localStorage.setItem(STORAGE_KEYS.STATUS, 'true');\n      state.token = token;\n    },\n    logout(state) {\n      state.token = null;\n      deleteCookie(STORAGE_KEYS.TOKEN);\n      window.localStorage.removeItem(STORAGE_KEYS.TOKEN);\n      window.localStorage.removeItem(STORAGE_KEYS.STATUS);\n    },\n  },\n});\n\nconst reducer = adminSlice.reducer;\n\nexport const { setAppTheme, setAvailableThemes, setLocale, setToken, logout, login } =\n  adminSlice.actions;\n\nexport { reducer, THEME_LOCAL_STORAGE_KEY, LANGUAGE_LOCAL_STORAGE_KEY };\nexport type { AppState, ThemeName };\n"],"names":["STORAGE_KEYS","TOKEN","STATUS","THEME_LOCAL_STORAGE_KEY","LANGUAGE_LOCAL_STORAGE_KEY","getStoredToken","fromLocalStorage","localStorage","getItem","JSON","parse","fromCookie","getCookieValue","adminSlice","createSlice","name","initialState","language","locale","localeNames","en","permissions","theme","availableThemes","currentTheme","token","reducers","setAppTheme","state","action","payload","window","setItem","setAvailableThemes","setLocale","document","documentElement","setAttribute","setToken","login","persist","setCookie","stringify","logout","deleteCookie","removeItem","reducer","actions"],"mappings":"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"}