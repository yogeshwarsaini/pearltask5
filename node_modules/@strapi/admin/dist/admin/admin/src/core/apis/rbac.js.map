{"version":3,"file":"rbac.js","sources":["../../../../../../admin/src/core/apis/rbac.ts"],"sourcesContent":["import { Location } from 'react-router-dom';\n\nimport type { Permission, User } from '../../features/Auth';\n\ninterface RBACContext extends Pick<Location, 'pathname' | 'search'> {\n  /**\n   * The current user.\n   */\n  user?: User;\n  /**\n   * The permissions of the current user.\n   */\n  permissions: Permission[];\n}\n\ninterface RBACMiddleware {\n  (\n    ctx: RBACContext\n  ): (\n    next: (permissions: Permission[]) => Promise<Permission[]> | Permission[]\n  ) => (permissions: Permission[]) => Promise<Permission[]> | Permission[];\n}\n\nclass RBAC {\n  private middlewares: RBACMiddleware[] = [];\n\n  constructor() {}\n\n  use(middleware: RBACMiddleware[]): void;\n  use(middleware: RBACMiddleware): void;\n  use(middleware: RBACMiddleware | RBACMiddleware[]): void {\n    if (Array.isArray(middleware)) {\n      this.middlewares.push(...middleware);\n    } else {\n      this.middlewares.push(middleware);\n    }\n  }\n\n  run = async (ctx: RBACContext, permissions: Permission[]): Promise<Permission[]> => {\n    let index = 0;\n\n    const middlewaresToRun = this.middlewares.map((middleware) => middleware(ctx));\n\n    const next = async (permissions: Permission[]) => {\n      if (index < this.middlewares.length) {\n        return middlewaresToRun[index++](next)(permissions);\n      }\n\n      return permissions;\n    };\n\n    return next(permissions);\n  };\n}\n\nexport { RBAC };\nexport type { RBACMiddleware, RBACContext };\n"],"names":["RBAC","use","middleware","Array","isArray","middlewares","push","constructor","run","ctx","permissions","index","middlewaresToRun","map","next","length"],"mappings":";;AAuBA,MAAMA,IAAAA,CAAAA;AAOJC,IAAAA,GAAAA,CAAIC,UAA6C,EAAQ;QACvD,IAAIC,KAAAA,CAAMC,OAAO,CAACF,UAAa,CAAA,EAAA;AAC7B,YAAA,IAAI,CAACG,WAAW,CAACC,IAAI,CAAIJ,GAAAA,UAAAA,CAAAA;SACpB,MAAA;AACL,YAAA,IAAI,CAACG,WAAW,CAACC,IAAI,CAACJ,UAAAA,CAAAA;AACxB;AACF;IAVAK,WAAc,EAAA;AAFNF,QAAAA,IAAAA,CAAAA,WAAAA,GAAgC,EAAE;AAc1CG,QAAAA,IAAAA,CAAAA,GAAAA,GAAM,OAAOC,GAAkBC,EAAAA,WAAAA,GAAAA;AAC7B,YAAA,IAAIC,KAAQ,GAAA,CAAA;YAEZ,MAAMC,gBAAAA,GAAmB,IAAI,CAACP,WAAW,CAACQ,GAAG,CAAC,CAACX,UAAAA,GAAeA,UAAWO,CAAAA,GAAAA,CAAAA,CAAAA;AAEzE,YAAA,MAAMK,OAAO,OAAOJ,WAAAA,GAAAA;AAClB,gBAAA,IAAIC,QAAQ,IAAI,CAACN,WAAW,CAACU,MAAM,EAAE;AACnC,oBAAA,OAAOH,gBAAgB,CAACD,KAAQ,EAAA,CAAA,CAACG,IAAMJ,CAAAA,CAAAA,WAAAA,CAAAA;AACzC;gBAEA,OAAOA,WAAAA;AACT,aAAA;AAEA,YAAA,OAAOI,IAAKJ,CAAAA,WAAAA,CAAAA;AACd,SAAA;AA1Be;AA2BjB;;;;"}