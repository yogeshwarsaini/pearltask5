{"version":3,"file":"UpsellBanner.mjs","sources":["../../../../../admin/src/components/UpsellBanner.tsx"],"sourcesContent":["import { useEffect } from 'react';\n\nimport { useLicenseLimits } from '@strapi/admin/strapi-admin/ee';\nimport { Box, Flex, LinkButton, Typography } from '@strapi/design-system';\nimport { isAfter, subDays } from 'date-fns';\nimport { useIntl } from 'react-intl';\nimport { styled } from 'styled-components';\n\nimport { useGetLicenseTrialTimeLeftQuery } from '../../src/services/admin';\nimport { usePersistentState } from '../hooks/usePersistentState';\n\nconst BannerBackground = styled(Flex)`\n  background: linear-gradient(\n    90deg,\n    ${({ theme }) => theme.colors.primary600} 0%,\n    ${({ theme }) => theme.colors.alternative600} 121.48%\n  );\n`;\n\nconst Banner = ({ isTrialEndedRecently }: { isTrialEndedRecently: boolean }) => {\n  const { formatMessage } = useIntl();\n\n  return (\n    <BannerBackground width=\"100%\" justifyContent=\"center\">\n      <Flex\n        justifyContent=\"center\"\n        alignItems=\"center\"\n        width=\"100%\"\n        paddingTop={2}\n        paddingBottom={2}\n        paddingLeft={10}\n        paddingRight={10}\n        gap={2}\n      >\n        <Box>\n          <Typography\n            variant=\"delta\"\n            fontWeight=\"bold\"\n            textColor=\"neutral0\"\n            textAlign=\"center\"\n            fontSize={2}\n          >\n            {formatMessage(\n              isTrialEndedRecently\n                ? {\n                    id: 'app.components.UpsellBanner.intro.ended',\n                    defaultMessage: 'Your trial has ended: ',\n                  }\n                : {\n                    id: 'app.components.UpsellBanner.intro',\n                    defaultMessage: 'Access to Growth plan features: ',\n                  }\n            )}\n          </Typography>\n          <Typography\n            variant=\"delta\"\n            textColor=\"neutral0\"\n            textAlign=\"center\"\n            paddingRight={4}\n            fontSize={2}\n          >\n            {formatMessage(\n              isTrialEndedRecently\n                ? {\n                    id: 'app.components.UpsellBanner.text.ended',\n                    defaultMessage: 'Keep access to Growth features by upgrading now.',\n                  }\n                : {\n                    id: 'app.components.UpsellBanner.text',\n                    defaultMessage:\n                      'As part of your trial, you can explore premium tools such as Content History, Releases, and Single Sign-On (SSO).',\n                  }\n            )}\n          </Typography>\n        </Box>\n        <Box>\n          <LinkButton\n            width=\"max-content\"\n            variant=\"tertiary\"\n            href=\"https://strapi.chargebeeportal.com\"\n            target=\"_blank\"\n          >\n            {formatMessage(\n              isTrialEndedRecently\n                ? {\n                    id: 'app.components.UpsellBanner.button.ended',\n                    defaultMessage: 'Keep Growth plan',\n                  }\n                : {\n                    id: 'app.components.UpsellBanner.button',\n                    defaultMessage: 'Upgrade now',\n                  }\n            )}\n          </LinkButton>\n        </Box>\n      </Flex>\n    </BannerBackground>\n  );\n};\n\nconst UpsellBanner = () => {\n  const { license } = useLicenseLimits();\n\n  const [cachedTrialEndsAt, setCachedTrialEndsAt] = usePersistentState<string | undefined>(\n    'STRAPI_FREE_TRIAL_ENDS_AT',\n    undefined\n  );\n\n  const sevenDaysAgo = subDays(new Date(), 7);\n\n  const timeLeftData = useGetLicenseTrialTimeLeftQuery(undefined, {\n    skip: !license?.isTrial,\n  });\n\n  useEffect(() => {\n    if (timeLeftData.data?.trialEndsAt) {\n      setCachedTrialEndsAt(timeLeftData.data.trialEndsAt);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [timeLeftData.data?.trialEndsAt]);\n\n  // When the license is not a trial + not EE, and the cached trial end date is found in the localstorage, that means the trial has ended\n  // We show the banner to encourage the user to upgrade (for 7 days after the trial ends)\n  const isTrialEndedRecently = Boolean(\n    !license?.isTrial &&\n      !window.strapi.isEE &&\n      cachedTrialEndsAt &&\n      isAfter(new Date(cachedTrialEndsAt), sevenDaysAgo)\n  );\n\n  if (timeLeftData.data?.trialEndsAt || isTrialEndedRecently) {\n    return <Banner isTrialEndedRecently={isTrialEndedRecently} />;\n  }\n\n  return null;\n};\n\nexport { UpsellBanner };\n"],"names":["BannerBackground","styled","Flex","theme","colors","primary600","alternative600","Banner","isTrialEndedRecently","formatMessage","useIntl","_jsx","width","justifyContent","_jsxs","alignItems","paddingTop","paddingBottom","paddingLeft","paddingRight","gap","Box","Typography","variant","fontWeight","textColor","textAlign","fontSize","id","defaultMessage","LinkButton","href","target","UpsellBanner","license","useLicenseLimits","cachedTrialEndsAt","setCachedTrialEndsAt","usePersistentState","undefined","sevenDaysAgo","subDays","Date","timeLeftData","useGetLicenseTrialTimeLeftQuery","skip","isTrial","useEffect","data","trialEndsAt","Boolean","window","strapi","isEE","isAfter"],"mappings":"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"}