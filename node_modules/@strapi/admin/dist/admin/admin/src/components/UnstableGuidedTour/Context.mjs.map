{"version":3,"file":"Context.mjs","sources":["../../../../../../admin/src/components/UnstableGuidedTour/Context.tsx"],"sourcesContent":["import * as React from 'react';\n\nimport { produce } from 'immer';\n\nimport { GetGuidedTourMeta } from '../../../../shared/contracts/admin';\nimport { usePersistentState } from '../../hooks/usePersistentState';\nimport { createContext } from '../Context';\n\nimport { type Tours, tours as guidedTours } from './Tours';\n\n/* -------------------------------------------------------------------------------------------------\n * GuidedTourProvider\n * -----------------------------------------------------------------------------------------------*/\n\ntype ValidTourName = keyof Tours;\n\nexport type ExtendedCompletedActions = (\n  | GetGuidedTourMeta.Response['data']['completedActions'][number]\n  | 'didCopyApiToken'\n)[];\n\ntype Action =\n  | {\n      type: 'next_step';\n      payload: ValidTourName;\n    }\n  | {\n      type: 'skip_tour';\n      payload: ValidTourName;\n    }\n  | {\n      type: 'set_completed_actions';\n      payload: ExtendedCompletedActions;\n    }\n  | {\n      type: 'skip_all_tours';\n    };\n\ntype Tour = Record<ValidTourName, { currentStep: number; length: number; isCompleted: boolean }>;\ntype State = {\n  tours: Tour;\n  enabled: boolean;\n  completedActions: ExtendedCompletedActions;\n};\n\nconst [GuidedTourProviderImpl, unstableUseGuidedTour] = createContext<{\n  state: State;\n  dispatch: React.Dispatch<Action>;\n}>('UnstableGuidedTour');\n\nfunction reducer(state: State, action: Action): State {\n  return produce(state, (draft) => {\n    if (action.type === 'next_step') {\n      const nextStep = draft.tours[action.payload].currentStep + 1;\n      draft.tours[action.payload].currentStep = nextStep;\n      draft.tours[action.payload].isCompleted = nextStep === draft.tours[action.payload].length;\n    }\n\n    if (action.type === 'skip_tour') {\n      draft.tours[action.payload].isCompleted = true;\n    }\n\n    if (action.type === 'set_completed_actions') {\n      draft.completedActions = [...new Set([...draft.completedActions, ...action.payload])];\n    }\n\n    if (action.type === 'skip_all_tours') {\n      draft.enabled = false;\n    }\n  });\n}\n\nconst STORAGE_KEY = 'STRAPI_GUIDED_TOUR';\n\nconst UnstableGuidedTourContext = ({\n  children,\n  enabled = true,\n}: {\n  children: React.ReactNode;\n  enabled?: boolean;\n}) => {\n  const initialTourState = Object.keys(guidedTours).reduce((acc, tourName) => {\n    const tourLength = Object.keys(guidedTours[tourName as ValidTourName]).length;\n    acc[tourName as ValidTourName] = {\n      currentStep: 0,\n      length: tourLength,\n      isCompleted: false,\n    };\n\n    return acc;\n  }, {} as Tour);\n\n  const [tours, setTours] = usePersistentState<State>(STORAGE_KEY, {\n    tours: initialTourState,\n    enabled,\n    completedActions: [],\n  });\n  const [state, dispatch] = React.useReducer(reducer, tours);\n\n  // Sync local storage\n  React.useEffect(() => {\n    if (window.strapi.future.isEnabled('unstableGuidedTour')) {\n      setTours(state);\n    }\n  }, [state, setTours]);\n\n  return (\n    <GuidedTourProviderImpl state={state} dispatch={dispatch}>\n      {children}\n    </GuidedTourProviderImpl>\n  );\n};\n\nexport type { Action, State, ValidTourName };\nexport { UnstableGuidedTourContext, unstableUseGuidedTour, reducer };\n"],"names":["GuidedTourProviderImpl","unstableUseGuidedTour","createContext","reducer","state","action","produce","draft","type","nextStep","tours","payload","currentStep","isCompleted","length","completedActions","Set","enabled","STORAGE_KEY","UnstableGuidedTourContext","children","initialTourState","Object","keys","guidedTours","reduce","acc","tourName","tourLength","setTours","usePersistentState","dispatch","React","useReducer","useEffect","window","strapi","future","isEnabled","_jsx"],"mappings":";;;;;;;AA6CA,MAAM,CAACA,sBAAAA,EAAwBC,qBAAsB,CAAA,GAAGC,aAGrD,CAAA,oBAAA;AAEH,SAASC,OAAAA,CAAQC,KAAY,EAAEC,MAAc,EAAA;IAC3C,OAAOC,OAAAA,CAAQF,OAAO,CAACG,KAAAA,GAAAA;QACrB,IAAIF,MAAAA,CAAOG,IAAI,KAAK,WAAa,EAAA;YAC/B,MAAMC,QAAAA,GAAWF,MAAMG,KAAK,CAACL,OAAOM,OAAO,CAAC,CAACC,WAAW,GAAG,CAAA;AAC3DL,YAAAA,KAAAA,CAAMG,KAAK,CAACL,MAAAA,CAAOM,OAAO,CAAC,CAACC,WAAW,GAAGH,QAAAA;AAC1CF,YAAAA,KAAAA,CAAMG,KAAK,CAACL,MAAAA,CAAOM,OAAO,CAAC,CAACE,WAAW,GAAGJ,QAAaF,KAAAA,KAAAA,CAAMG,KAAK,CAACL,MAAAA,CAAOM,OAAO,CAAC,CAACG,MAAM;AAC3F;QAEA,IAAIT,MAAAA,CAAOG,IAAI,KAAK,WAAa,EAAA;AAC/BD,YAAAA,KAAAA,CAAMG,KAAK,CAACL,MAAAA,CAAOM,OAAO,CAAC,CAACE,WAAW,GAAG,IAAA;AAC5C;QAEA,IAAIR,MAAAA,CAAOG,IAAI,KAAK,uBAAyB,EAAA;AAC3CD,YAAAA,KAAAA,CAAMQ,gBAAgB,GAAG;AAAI,gBAAA,GAAA,IAAIC,GAAI,CAAA;AAAIT,oBAAAA,GAAAA,KAAAA,CAAMQ,gBAAgB;AAAKV,oBAAAA,GAAAA,MAAAA,CAAOM;AAAQ,iBAAA;AAAE,aAAA;AACvF;QAEA,IAAIN,MAAAA,CAAOG,IAAI,KAAK,gBAAkB,EAAA;AACpCD,YAAAA,KAAAA,CAAMU,OAAO,GAAG,KAAA;AAClB;AACF,KAAA,CAAA;AACF;AAEA,MAAMC,WAAc,GAAA,oBAAA;AAEpB,MAAMC,4BAA4B,CAAC,EACjCC,QAAQ,EACRH,OAAAA,GAAU,IAAI,EAIf,GAAA;IACC,MAAMI,gBAAAA,GAAmBC,OAAOC,IAAI,CAACC,OAAaC,MAAM,CAAC,CAACC,GAAKC,EAAAA,QAAAA,GAAAA;QAC7D,MAAMC,UAAAA,GAAaN,OAAOC,IAAI,CAACC,KAAW,CAACG,QAAAA,CAA0B,EAAEb,MAAM;QAC7EY,GAAG,CAACC,SAA0B,GAAG;YAC/Bf,WAAa,EAAA,CAAA;YACbE,MAAQc,EAAAA,UAAAA;YACRf,WAAa,EAAA;AACf,SAAA;QAEA,OAAOa,GAAAA;AACT,KAAA,EAAG,EAAC,CAAA;AAEJ,IAAA,MAAM,CAAChB,OAAAA,EAAOmB,QAAS,CAAA,GAAGC,mBAA0BZ,WAAa,EAAA;QAC/DR,KAAOW,EAAAA,gBAAAA;AACPJ,QAAAA,OAAAA;AACAF,QAAAA,gBAAAA,EAAkB;AACpB,KAAA,CAAA;AACA,IAAA,MAAM,CAACX,KAAO2B,EAAAA,QAAAA,CAAS,GAAGC,KAAMC,CAAAA,UAAU,CAAC9B,OAASO,EAAAA,OAAAA,CAAAA;;AAGpDsB,IAAAA,KAAAA,CAAME,SAAS,CAAC,IAAA;AACd,QAAA,IAAIC,OAAOC,MAAM,CAACC,MAAM,CAACC,SAAS,CAAC,oBAAuB,CAAA,EAAA;YACxDT,QAASzB,CAAAA,KAAAA,CAAAA;AACX;KACC,EAAA;AAACA,QAAAA,KAAAA;AAAOyB,QAAAA;AAAS,KAAA,CAAA;AAEpB,IAAA,qBACEU,GAACvC,CAAAA,sBAAAA,EAAAA;QAAuBI,KAAOA,EAAAA,KAAAA;QAAO2B,QAAUA,EAAAA,QAAAA;AAC7CX,QAAAA,QAAAA,EAAAA;;AAGP;;;;"}