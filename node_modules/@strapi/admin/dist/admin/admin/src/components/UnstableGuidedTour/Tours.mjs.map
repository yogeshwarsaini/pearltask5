{"version":3,"file":"Tours.mjs","sources":["../../../../../../admin/src/components/UnstableGuidedTour/Tours.tsx"],"sourcesContent":["import * as React from 'react';\n\nimport { Box, Popover, Portal, Flex, Button, FlexProps } from '@strapi/design-system';\nimport { FormattedMessage } from 'react-intl';\nimport { styled } from 'styled-components';\n\nimport { useGetGuidedTourMetaQuery } from '../../services/admin';\n\nimport {\n  type State,\n  type Action,\n  unstableUseGuidedTour,\n  ValidTourName,\n  ExtendedCompletedActions,\n} from './Context';\nimport { Step, StepCount, createStepComponents } from './Step';\n\n/* -------------------------------------------------------------------------------------------------\n * Tours\n * -----------------------------------------------------------------------------------------------*/\n\nconst GotItAction = ({ onClick }: { onClick: () => void }) => {\n  return (\n    <Button onClick={onClick}>\n      <FormattedMessage id=\"tours.gotIt\" defaultMessage=\"Got it\" />\n    </Button>\n  );\n};\n\nconst tours = {\n  contentTypeBuilder: createTour('contentTypeBuilder', [\n    {\n      name: 'Introduction',\n      content: (Step) => (\n        <Step.Root side=\"bottom\" withArrow={false}>\n          <Step.Title\n            id=\"tours.contentTypeBuilder.Introduction.title\"\n            defaultMessage=\"Content-Type Builder\"\n          />\n          <Step.Content\n            id=\"tours.contentTypeBuilder.Introduction.content\"\n            defaultMessage=\"Create and manage your content structure with collection types, single types and components.\"\n          />\n          <Step.Actions showSkip />\n        </Step.Root>\n      ),\n    },\n    {\n      name: 'CollectionTypes',\n      content: (Step) => (\n        <Step.Root side=\"right\" sideOffset={16}>\n          <Step.Title\n            id=\"tours.contentTypeBuilder.CollectionTypes.title\"\n            defaultMessage=\"Collection Types\"\n          />\n          <Step.Content\n            id=\"tours.contentTypeBuilder.CollectionTypes.content\"\n            defaultMessage=\"A content structure that can manage multiple entries, such as articles or products.\"\n          />\n          <Step.Actions />\n        </Step.Root>\n      ),\n    },\n    {\n      name: 'SingleTypes',\n      content: (Step) => (\n        <Step.Root side=\"right\" sideOffset={16}>\n          <Step.Title\n            id=\"tours.contentTypeBuilder.SingleTypes.title\"\n            defaultMessage=\"Single Types\"\n          />\n          <Step.Content\n            id=\"tours.contentTypeBuilder.SingleTypes.content\"\n            defaultMessage=\"A content structure that can manage a single entry, such as a homepage or a header.\"\n          />\n          <Step.Actions />\n        </Step.Root>\n      ),\n    },\n    {\n      name: 'Components',\n      content: (Step, { dispatch }) => (\n        <Step.Root side=\"right\" sideOffset={16}>\n          <Step.Title id=\"tours.contentTypeBuilder.Components.title\" defaultMessage=\"Components\" />\n          <Step.Content\n            id=\"tours.contentTypeBuilder.Components.content\"\n            defaultMessage=\"A reusable content structure that can be used across multiple content types, such as buttons, sliders or cards.\"\n          />\n          <Step.Actions justifyContent=\"flex-end\">\n            <GotItAction\n              onClick={() => dispatch({ type: 'next_step', payload: 'contentTypeBuilder' })}\n            />\n          </Step.Actions>\n        </Step.Root>\n      ),\n    },\n    {\n      name: 'Finish',\n      content: (Step) => (\n        <Step.Root side=\"right\">\n          <Step.Title\n            id=\"tours.contentTypeBuilder.Finish.title\"\n            defaultMessage=\"It’s time to create content!\"\n          />\n          <Step.Content\n            id=\"tours.contentTypeBuilder.Finish.content\"\n            defaultMessage=\"Now that you created content types, you’ll be able to create content in the content manager.\"\n          />\n          <Step.Actions showStepCount={false} to=\"/content-manager\" />\n        </Step.Root>\n      ),\n      when: (completedActions) => completedActions.includes('didCreateContentTypeSchema'),\n    },\n  ]),\n  contentManager: createTour('contentManager', [\n    {\n      name: 'Introduction',\n      when: (completedActions) =>\n        completedActions.includes('didCreateContentTypeSchema') &&\n        !completedActions.includes('didCreateContent'),\n      content: (Step) => (\n        <Step.Root side=\"top\" withArrow={false}>\n          <Step.Title\n            id=\"tours.contentManager.Introduction.title\"\n            defaultMessage=\"Content manager\"\n          />\n          <Step.Content\n            id=\"tours.contentManager.Introduction.content\"\n            defaultMessage=\"Create and manage content from your collection types and single types.\"\n          />\n          <Step.Actions showSkip />\n        </Step.Root>\n      ),\n    },\n    {\n      name: 'Fields',\n      content: (Step) => (\n        <Step.Root sideOffset={-12}>\n          <Step.Title id=\"tours.contentManager.Fields.title\" defaultMessage=\"Fields\" />\n          <Step.Content\n            id=\"tours.contentManager.Fields.content\"\n            defaultMessage=\"Add content to the fields created in the Content-Type Builder.\"\n          />\n          <Step.Actions />\n        </Step.Root>\n      ),\n    },\n    {\n      name: 'Publish',\n      content: (Step, { dispatch }) => (\n        <Step.Root side=\"left\" align=\"center\">\n          <Step.Title id=\"tours.contentManager.Publish.title\" defaultMessage=\"Publish\" />\n          <Step.Content\n            id=\"tours.contentManager.Publish.content\"\n            defaultMessage=\"Publish entries to make their content available through the Document Service API.\"\n          />\n          <Step.Actions justifyContent=\"flex-end\">\n            <GotItAction\n              onClick={() => dispatch({ type: 'next_step', payload: 'contentManager' })}\n            />\n          </Step.Actions>\n        </Step.Root>\n      ),\n    },\n    {\n      name: 'Finish',\n      content: (Step) => (\n        <Step.Root side=\"right\">\n          <Step.Title\n            id=\"tours.contentManager.FinalStep.title\"\n            defaultMessage=\"It’s time to create API Tokens!\"\n          />\n          <Step.Content\n            id=\"tours.contentManager.FinalStep.content\"\n            defaultMessage=\"Now that you’ve created and published content, time to create API tokens and set up permissions.\"\n          />\n          <Step.Actions showStepCount={false} to=\"/settings/api-tokens\" />\n        </Step.Root>\n      ),\n      when: (completedActions) => completedActions.includes('didCreateContent'),\n    },\n  ]),\n  apiTokens: createTour('apiTokens', [\n    {\n      name: 'Introduction',\n      when: (completedActions) => !completedActions.includes('didCreateApiToken'),\n      content: (Step) => (\n        <Step.Root sideOffset={-36} withArrow={false}>\n          <Step.Title id=\"tours.apiTokens.Introduction.title\" defaultMessage=\"API tokens\" />\n          <Step.Content\n            id=\"tours.apiTokens.Introduction.content\"\n            defaultMessage=\"Create and manage API tokens with highly customizable permissions.\"\n          />\n          <Step.Actions showSkip />\n        </Step.Root>\n      ),\n    },\n    {\n      name: 'CreateAnAPIToken',\n      content: (Step) => (\n        <Step.Root side=\"bottom\" align=\"end\" sideOffset={-10}>\n          <Step.Title\n            id=\"tours.apiTokens.CreateAnAPIToken.title\"\n            defaultMessage=\"Create an API token\"\n          />\n          <Step.Content\n            id=\"tours.apiTokens.CreateAnAPIToken.content\"\n            defaultMessage=\"Create a new API token. Choose a name, duration and type.\"\n          />\n          <Step.Actions />\n        </Step.Root>\n      ),\n    },\n    {\n      name: 'CopyAPIToken',\n      content: (Step, { dispatch }) => (\n        <Step.Root side=\"bottom\" align=\"start\" sideOffset={-5}>\n          <Step.Title\n            id=\"tours.apiTokens.CopyAPIToken.title\"\n            defaultMessage=\"Copy your new API token\"\n          />\n          <Step.Content\n            id=\"tours.apiTokens.CopyAPIToken.content\"\n            defaultMessage=\"Make sure to do it now, you won’t be able to see it again. You’ll need to generate a new one if you lose it.\"\n          />\n          <Step.Actions>\n            <StepCount tourName=\"apiTokens\" />\n            <GotItAction onClick={() => dispatch({ type: 'next_step', payload: 'apiTokens' })} />\n          </Step.Actions>\n        </Step.Root>\n      ),\n      when: (completedActions) => completedActions.includes('didCreateApiToken'),\n    },\n    {\n      name: 'Finish',\n      content: (Step) => (\n        <Step.Root side=\"right\" align=\"start\">\n          <Step.Title\n            id=\"tours.apiTokens.FinalStep.title\"\n            defaultMessage=\"It’s time to deploy your application!\"\n          />\n          <Step.Content\n            id=\"tours.apiTokens.FinalStep.content\"\n            defaultMessage=\"Your application is ready to be deployed and its content to be shared with the world!\"\n          />\n          <Step.Actions showStepCount={false} to=\"/\" />\n        </Step.Root>\n      ),\n      when: (completedActions) => completedActions.includes('didCopyApiToken'),\n    },\n  ]),\n  strapiCloud: createTour('strapiCloud', []),\n} as const;\n\ntype Tours = typeof tours;\n\n/* -------------------------------------------------------------------------------------------------\n * GuidedTourTooltip\n * -----------------------------------------------------------------------------------------------*/\n\ntype Content = (\n  Step: Step,\n  {\n    state,\n    dispatch,\n  }: {\n    state: State;\n    dispatch: React.Dispatch<Action>;\n  }\n) => React.ReactNode;\n\ntype GuidedTourTooltipProps = {\n  children: React.ReactNode;\n  content: Content;\n  tourName: ValidTourName;\n  step: number;\n  when?: (completedActions: ExtendedCompletedActions) => boolean;\n};\n\nconst UnstableGuidedTourTooltip = ({ children, ...props }: GuidedTourTooltipProps) => {\n  const state = unstableUseGuidedTour('TooltipWrapper', (s) => s.state);\n  const hasFutureFlag = window.strapi.future.isEnabled('unstableGuidedTour');\n\n  if (!state.enabled) {\n    return <>{children}</>;\n  }\n\n  if (!hasFutureFlag) {\n    return <>{children}</>;\n  }\n\n  return <GuidedTourTooltipImpl {...props}>{children}</GuidedTourTooltipImpl>;\n};\n\nconst GuidedTourOverlay = styled(Box)`\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: rgba(50, 50, 77, 0.2);\n  z-index: 10;\n`;\n\nconst GuidedTourTooltipImpl = ({\n  children,\n  content,\n  tourName,\n  step,\n  when,\n}: GuidedTourTooltipProps) => {\n  const { data: guidedTourMeta } = useGetGuidedTourMetaQuery();\n\n  const state = unstableUseGuidedTour('UnstableGuidedTourTooltip', (s) => s.state);\n  const dispatch = unstableUseGuidedTour('UnstableGuidedTourTooltip', (s) => s.dispatch);\n\n  const isCurrentStep = state.tours[tourName].currentStep === step;\n  const isStepConditionMet = when ? when(state.completedActions) : true;\n  const isPopoverOpen =\n    guidedTourMeta?.data?.isFirstSuperAdminUser &&\n    !state.tours[tourName].isCompleted &&\n    isCurrentStep &&\n    isStepConditionMet;\n\n  // Lock the scroll\n  React.useEffect(() => {\n    if (!isPopoverOpen) return;\n\n    const originalStyle = window.getComputedStyle(document.body).overflow;\n    document.body.style.overflow = 'hidden';\n\n    return () => {\n      document.body.style.overflow = originalStyle;\n    };\n  }, [isPopoverOpen]);\n\n  // TODO: This isn't great but the only solution for syncing the completed actions\n  React.useEffect(() => {\n    dispatch({\n      type: 'set_completed_actions',\n      payload: guidedTourMeta?.data?.completedActions ?? [],\n    });\n  }, [dispatch, guidedTourMeta?.data?.completedActions]);\n\n  const Step = React.useMemo(() => createStepComponents(tourName), [tourName]);\n\n  return (\n    <>\n      {isPopoverOpen && (\n        <Portal>\n          <GuidedTourOverlay />\n        </Portal>\n      )}\n      <Popover.Root open={isPopoverOpen}>\n        <Popover.Anchor>{children}</Popover.Anchor>\n        {content(Step, { state, dispatch })}\n      </Popover.Root>\n    </>\n  );\n};\n\n/* -------------------------------------------------------------------------------------------------\n * Tour factory\n * -----------------------------------------------------------------------------------------------*/\n\ntype TourStep<P extends string> = {\n  name: P;\n  content: Content;\n  when?: (completedActions: ExtendedCompletedActions) => boolean;\n};\n\nfunction createTour<const T extends ReadonlyArray<TourStep<string>>>(tourName: string, steps: T) {\n  type Components = {\n    [K in T[number]['name']]: React.ComponentType<{ children: React.ReactNode }>;\n  };\n\n  const tour = steps.reduce((acc, step, index) => {\n    if (step.name in acc) {\n      throw Error(`The tour: ${tourName} with step: ${step.name} has already been registered`);\n    }\n\n    acc[step.name as keyof Components] = ({ children }: { children: React.ReactNode }) => {\n      return (\n        <UnstableGuidedTourTooltip\n          tourName={tourName as ValidTourName}\n          step={index}\n          content={step.content}\n          when={step.when}\n        >\n          {children}\n        </UnstableGuidedTourTooltip>\n      );\n    };\n\n    return acc;\n  }, {} as Components);\n\n  return tour;\n}\n\nexport type { Content, Tours };\nexport { tours };\n"],"names":["GotItAction","onClick","_jsx","Button","FormattedMessage","id","defaultMessage","tours","contentTypeBuilder","createTour","name","content","Step","_jsxs","Root","side","withArrow","Title","Content","Actions","showSkip","sideOffset","dispatch","justifyContent","type","payload","showStepCount","to","when","completedActions","includes","contentManager","align","apiTokens","StepCount","tourName","strapiCloud","UnstableGuidedTourTooltip","children","props","state","unstableUseGuidedTour","s","hasFutureFlag","window","strapi","future","isEnabled","enabled","_Fragment","GuidedTourTooltipImpl","GuidedTourOverlay","styled","Box","step","data","guidedTourMeta","useGetGuidedTourMetaQuery","isCurrentStep","currentStep","isStepConditionMet","isPopoverOpen","isFirstSuperAdminUser","isCompleted","React","useEffect","originalStyle","getComputedStyle","document","body","overflow","style","useMemo","createStepComponents","Portal","Popover","open","Anchor","steps","tour","reduce","acc","index","Error"],"mappings":"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"}