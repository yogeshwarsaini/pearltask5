{"version":3,"file":"index.js","sources":["../../src/migrations/index.ts"],"sourcesContent":["import { createUserMigrationProvider } from './users';\nimport { createInternalMigrationProvider } from './internal';\n\nimport type { MigrationProvider, Migration } from './common';\nimport type { Database } from '..';\n\nexport type { MigrationProvider, Migration };\n\nexport const createMigrationsProvider = (db: Database): MigrationProvider => {\n  const userProvider = createUserMigrationProvider(db);\n  const internalProvider = createInternalMigrationProvider(db);\n  const providers = [userProvider, internalProvider];\n\n  return {\n    providers: {\n      internal: internalProvider,\n    },\n    async shouldRun() {\n      const shouldRunResponses = await Promise.all(\n        providers.map((provider) => provider.shouldRun())\n      );\n\n      return shouldRunResponses.some((shouldRun) => shouldRun);\n    },\n    async up() {\n      for (const provider of providers) {\n        if (await provider.shouldRun()) {\n          await provider.up();\n        }\n      }\n    },\n    async down() {\n      for (const provider of providers) {\n        if (await provider.shouldRun()) {\n          await provider.down();\n        }\n      }\n    },\n  };\n};\n"],"names":["createMigrationsProvider","db","userProvider","createUserMigrationProvider","internalProvider","createInternalMigrationProvider","providers","internal","shouldRun","shouldRunResponses","Promise","all","map","provider","some","up","down"],"mappings":";;;;;AAQO,MAAMA,2BAA2B,CAACC,EAAAA,GAAAA;AACvC,IAAA,MAAMC,eAAeC,iCAA4BF,CAAAA,EAAAA,CAAAA;AACjD,IAAA,MAAMG,mBAAmBC,wCAAgCJ,CAAAA,EAAAA,CAAAA;AACzD,IAAA,MAAMK,SAAY,GAAA;AAACJ,QAAAA,YAAAA;AAAcE,QAAAA;AAAiB,KAAA;IAElD,OAAO;QACLE,SAAW,EAAA;YACTC,QAAUH,EAAAA;AACZ,SAAA;QACA,MAAMI,SAAAA,CAAAA,GAAAA;YACJ,MAAMC,kBAAAA,GAAqB,MAAMC,OAAAA,CAAQC,GAAG,CAC1CL,SAAUM,CAAAA,GAAG,CAAC,CAACC,QAAaA,GAAAA,QAAAA,CAASL,SAAS,EAAA,CAAA,CAAA;AAGhD,YAAA,OAAOC,kBAAmBK,CAAAA,IAAI,CAAC,CAACN,SAAcA,GAAAA,SAAAA,CAAAA;AAChD,SAAA;QACA,MAAMO,EAAAA,CAAAA,GAAAA;YACJ,KAAK,MAAMF,YAAYP,SAAW,CAAA;gBAChC,IAAI,MAAMO,QAASL,CAAAA,SAAS,EAAI,EAAA;AAC9B,oBAAA,MAAMK,SAASE,EAAE,EAAA;AACnB;AACF;AACF,SAAA;QACA,MAAMC,IAAAA,CAAAA,GAAAA;YACJ,KAAK,MAAMH,YAAYP,SAAW,CAAA;gBAChC,IAAI,MAAMO,QAASL,CAAAA,SAAS,EAAI,EAAA;AAC9B,oBAAA,MAAMK,SAASG,IAAI,EAAA;AACrB;AACF;AACF;AACF,KAAA;AACF;;;;"}