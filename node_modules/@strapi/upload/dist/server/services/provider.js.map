{"version":3,"file":"provider.js","sources":["../../../server/src/services/provider.ts"],"sourcesContent":["import { isFunction } from 'lodash/fp';\nimport { file as fileUtils } from '@strapi/utils';\nimport type { Core } from '@strapi/types';\n\nimport { Config, UploadableFile } from '../types';\n\nexport default ({ strapi }: { strapi: Core.Strapi }) => ({\n  async checkFileSize(file: UploadableFile) {\n    const { sizeLimit } = strapi.config.get<Config>('plugin::upload');\n    await strapi.plugin('upload').provider.checkFileSize(file, { sizeLimit });\n  },\n\n  async upload(file: UploadableFile) {\n    if (isFunction(strapi.plugin('upload').provider.uploadStream)) {\n      file.stream = file.getStream();\n      await strapi.plugin('upload').provider.uploadStream(file);\n\n      delete file.stream;\n\n      if ('filepath' in file) {\n        delete file.filepath;\n      }\n    } else {\n      file.buffer = await fileUtils.streamToBuffer(file.getStream());\n      await strapi.plugin('upload').provider.upload(file);\n\n      delete file.buffer;\n\n      if ('filepath' in file) {\n        delete file.filepath;\n      }\n    }\n  },\n});\n"],"names":["strapi","checkFileSize","file","sizeLimit","config","get","plugin","provider","upload","isFunction","uploadStream","stream","getStream","filepath","buffer","fileUtils","streamToBuffer"],"mappings":";;;;;AAMA,eAAe,CAAA,CAAC,EAAEA,MAAM,EAA2B,IAAM;AACvD,QAAA,MAAMC,eAAcC,IAAoB,EAAA;YACtC,MAAM,EAAEC,SAAS,EAAE,GAAGH,OAAOI,MAAM,CAACC,GAAG,CAAS,gBAAA,CAAA;YAChD,MAAML,MAAAA,CAAOM,MAAM,CAAC,QAAA,CAAA,CAAUC,QAAQ,CAACN,aAAa,CAACC,IAAM,EAAA;AAAEC,gBAAAA;AAAU,aAAA,CAAA;AACzE,SAAA;AAEA,QAAA,MAAMK,QAAON,IAAoB,EAAA;YAC/B,IAAIO,aAAAA,CAAWT,OAAOM,MAAM,CAAC,UAAUC,QAAQ,CAACG,YAAY,CAAG,EAAA;gBAC7DR,IAAKS,CAAAA,MAAM,GAAGT,IAAAA,CAAKU,SAAS,EAAA;AAC5B,gBAAA,MAAMZ,OAAOM,MAAM,CAAC,UAAUC,QAAQ,CAACG,YAAY,CAACR,IAAAA,CAAAA;AAEpD,gBAAA,OAAOA,KAAKS,MAAM;AAElB,gBAAA,IAAI,cAAcT,IAAM,EAAA;AACtB,oBAAA,OAAOA,KAAKW,QAAQ;AACtB;aACK,MAAA;AACLX,gBAAAA,IAAAA,CAAKY,MAAM,GAAG,MAAMC,WAAUC,cAAc,CAACd,KAAKU,SAAS,EAAA,CAAA;AAC3D,gBAAA,MAAMZ,OAAOM,MAAM,CAAC,UAAUC,QAAQ,CAACC,MAAM,CAACN,IAAAA,CAAAA;AAE9C,gBAAA,OAAOA,KAAKY,MAAM;AAElB,gBAAA,IAAI,cAAcZ,IAAM,EAAA;AACtB,oBAAA,OAAOA,KAAKW,QAAQ;AACtB;AACF;AACF;AACF,KAAA,CAAC;;;;"}