{"version":3,"file":"ConfigureTheView.mjs","sources":["../../../../../admin/src/pages/App/ConfigureTheView/ConfigureTheView.tsx"],"sourcesContent":["// TODO: find a better naming convention for the file that was an index file before\nimport * as React from 'react';\n\nimport {\n  ConfirmDialog,\n  useTracking,\n  useNotification,\n  Page,\n  Layouts,\n} from '@strapi/admin/strapi-admin';\nimport { Button, Dialog, Link } from '@strapi/design-system';\nimport { ArrowLeft, Check } from '@strapi/icons';\nimport isEqual from 'lodash/isEqual';\nimport { useIntl } from 'react-intl';\nimport { NavLink } from 'react-router-dom';\n\nimport { useConfig } from '../../../hooks/useConfig';\nimport { pluginId } from '../../../pluginId';\nimport { getTrad } from '../../../utils';\n\nimport { Settings } from './components/Settings';\nimport { onChange, setLoaded } from './state/actions';\nimport { init, initialState } from './state/init';\nimport { reducer } from './state/reducer';\n\nimport type { InitialState } from './state/init';\nimport type { Action } from './state/reducer';\nimport type { Configuration } from '../../../../../shared/contracts/configuration';\n\ninterface ConfigureTheViewProps {\n  config: Configuration;\n}\n\nexport const ConfigureTheView = ({ config }: ConfigureTheViewProps) => {\n  const { trackUsage } = useTracking();\n  const { formatMessage } = useIntl();\n  const { toggleNotification } = useNotification();\n  const { mutateConfig } = useConfig();\n  const { isLoading: isSubmittingForm } = mutateConfig;\n\n  const [showWarningSubmit, setWarningSubmit] = React.useState(false);\n  const toggleWarningSubmit = () => setWarningSubmit((prevState) => !prevState);\n\n  const [reducerState, dispatch] = React.useReducer(\n    reducer,\n    initialState,\n    (): InitialState => init(config)\n  );\n  const typedDispatch: React.Dispatch<Action> = dispatch;\n  const { initialData, modifiedData } = reducerState;\n\n  const handleSubmit = (e: React.FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n    toggleWarningSubmit();\n  };\n\n  const handleConfirm = async () => {\n    trackUsage('willEditMediaLibraryConfig');\n    await mutateConfig.mutateAsync(modifiedData as Configuration);\n    setWarningSubmit(false);\n    typedDispatch(setLoaded());\n    toggleNotification({\n      type: 'success',\n      message: formatMessage({\n        id: 'notification.form.success.fields',\n        defaultMessage: 'Changes saved',\n      }),\n    });\n  };\n\n  const handleChange = ({\n    target: { name, value },\n  }: {\n    target: { name: keyof Configuration; value: string | number };\n  }) => {\n    typedDispatch(onChange({ name, value }));\n  };\n\n  return (\n    <Layouts.Root>\n      <Page.Main aria-busy={isSubmittingForm}>\n        <form onSubmit={handleSubmit}>\n          <Layouts.Header\n            navigationAction={\n              <Link\n                tag={NavLink}\n                startIcon={<ArrowLeft />}\n                to={`/plugins/${pluginId}`}\n                id=\"go-back\"\n              >\n                {formatMessage({ id: getTrad('config.back'), defaultMessage: 'Back' })}\n              </Link>\n            }\n            primaryAction={\n              <Button\n                size=\"S\"\n                startIcon={<Check />}\n                disabled={isEqual(modifiedData, initialData)}\n                type=\"submit\"\n              >\n                {formatMessage({ id: 'global.save', defaultMessage: 'Save' })}\n              </Button>\n            }\n            subtitle={formatMessage({\n              id: getTrad('config.subtitle'),\n              defaultMessage: 'Define the view settings of the media library.',\n            })}\n            title={formatMessage({\n              id: getTrad('config.title'),\n              defaultMessage: 'Configure the view - Media Library',\n            })}\n          />\n          <Layouts.Content>\n            <Settings\n              data-testid=\"settings\"\n              pageSize={modifiedData.pageSize || ''}\n              sort={modifiedData.sort || ''}\n              onChange={handleChange}\n            />\n          </Layouts.Content>\n          x\n          <Dialog.Root open={showWarningSubmit} onOpenChange={toggleWarningSubmit}>\n            <ConfirmDialog onConfirm={handleConfirm} variant=\"default\">\n              {formatMessage({\n                id: getTrad('config.popUpWarning.warning.updateAllSettings'),\n                defaultMessage: 'This will modify all your settings',\n              })}\n            </ConfirmDialog>\n          </Dialog.Root>\n        </form>\n      </Page.Main>\n    </Layouts.Root>\n  );\n};\n"],"names":["ConfigureTheView","config","trackUsage","useTracking","formatMessage","useIntl","toggleNotification","useNotification","mutateConfig","useConfig","isLoading","isSubmittingForm","showWarningSubmit","setWarningSubmit","React","useState","toggleWarningSubmit","prevState","reducerState","dispatch","useReducer","reducer","initialState","init","typedDispatch","initialData","modifiedData","handleSubmit","e","preventDefault","handleConfirm","mutateAsync","setLoaded","type","message","id","defaultMessage","handleChange","target","name","value","onChange","_jsx","Layouts","Root","Page","Main","aria-busy","_jsxs","form","onSubmit","Header","navigationAction","Link","tag","NavLink","startIcon","ArrowLeft","to","pluginId","getTrad","primaryAction","Button","size","Check","disabled","isEqual","subtitle","title","Content","Settings","data-testid","pageSize","sort","Dialog","open","onOpenChange","ConfirmDialog","onConfirm","variant"],"mappings":"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"}