{"version":3,"file":"index.js","sources":["../../../server/src/history/index.ts"],"sourcesContent":["import type { Plugin } from '@strapi/types';\nimport { controllers } from './controllers';\nimport { services } from './services';\nimport { routes } from './routes';\nimport { getService } from './utils';\nimport { historyVersion } from './models/history-version';\n\n/**\n * Check once if the feature is enabled before loading it,\n * so that we can assume it is enabled in the other files.\n */\nconst getFeature = (): Partial<Plugin.LoadedPlugin> => {\n  if (strapi.ee.features.isEnabled('cms-content-history')) {\n    return {\n      register({ strapi }) {\n        strapi.get('models').add(historyVersion);\n      },\n      bootstrap({ strapi }) {\n        // Start recording history and saving history versions\n        getService(strapi, 'lifecycles').bootstrap();\n      },\n      destroy({ strapi }) {\n        getService(strapi, 'lifecycles').destroy();\n      },\n      controllers,\n      services,\n      routes,\n    };\n  }\n\n  /**\n   * Keep registering the model to avoid losing the data if the feature is disabled,\n   * or if the license expires.\n   */\n  return {\n    register({ strapi }) {\n      strapi.get('models').add(historyVersion);\n    },\n  };\n};\n\nexport default getFeature();\n"],"names":["getFeature","strapi","ee","features","isEnabled","register","get","add","historyVersion","bootstrap","getService","destroy","controllers","services","routes"],"mappings":";;;;;;;;AAOA;;;AAGC,IACD,MAAMA,UAAa,GAAA,IAAA;AACjB,IAAA,IAAIC,OAAOC,EAAE,CAACC,QAAQ,CAACC,SAAS,CAAC,qBAAwB,CAAA,EAAA;QACvD,OAAO;YACLC,QAAS,CAAA,CAAA,EAAEJ,MAAAA,EAAAA,OAAM,EAAE,EAAA;AACjBA,gBAAAA,OAAAA,CAAOK,GAAG,CAAC,QAAUC,CAAAA,CAAAA,GAAG,CAACC,6BAAAA,CAAAA;AAC3B,aAAA;YACAC,SAAU,CAAA,CAAA,EAAER,MAAAA,EAAAA,OAAM,EAAE,EAAA;;gBAElBS,gBAAWT,CAAAA,OAAAA,EAAQ,cAAcQ,SAAS,EAAA;AAC5C,aAAA;YACAE,OAAQ,CAAA,CAAA,EAAEV,MAAAA,EAAAA,OAAM,EAAE,EAAA;gBAChBS,gBAAWT,CAAAA,OAAAA,EAAQ,cAAcU,OAAO,EAAA;AAC1C,aAAA;AACAC,yBAAAA,iBAAAA;AACAC,sBAAAA,gBAAAA;AACAC,oBAAAA;AACF,SAAA;AACF;AAEA;;;AAGC,MACD,OAAO;QACLT,QAAS,CAAA,CAAA,EAAEJ,MAAAA,EAAAA,OAAM,EAAE,EAAA;AACjBA,YAAAA,OAAAA,CAAOK,GAAG,CAAC,QAAUC,CAAAA,CAAAA,GAAG,CAACC,6BAAAA,CAAAA;AAC3B;AACF,KAAA;AACF,CAAA;AAEA,cAAeR,UAAa,EAAA;;;;"}