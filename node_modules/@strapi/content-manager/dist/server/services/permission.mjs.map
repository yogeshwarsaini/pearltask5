{"version":3,"file":"permission.mjs","sources":["../../../server/src/services/permission.ts"],"sourcesContent":["import { prop } from 'lodash/fp';\nimport { contentTypes as contentTypesUtils } from '@strapi/utils';\n\nimport type { Core, Struct } from '@strapi/types';\nimport { getService } from '../utils';\n\nexport default ({ strapi }: { strapi: Core.Strapi }) => ({\n  canConfigureContentType({\n    userAbility,\n    contentType,\n  }: {\n    userAbility: any;\n    contentType: Struct.ContentTypeSchema;\n  }) {\n    const action = contentTypesUtils.isSingleType(contentType)\n      ? 'plugin::content-manager.single-types.configure-view'\n      : 'plugin::content-manager.collection-types.configure-view';\n\n    return userAbility.can(action);\n  },\n\n  async registerPermissions() {\n    const displayedContentTypes = getService('content-types').findDisplayedContentTypes();\n    const contentTypesUids = displayedContentTypes.map(prop('uid'));\n\n    const actions = [\n      {\n        section: 'contentTypes',\n        displayName: 'Create',\n        uid: 'explorer.create',\n        pluginName: 'content-manager',\n        subjects: contentTypesUids,\n        options: {\n          applyToProperties: ['fields'],\n        },\n      },\n      {\n        section: 'contentTypes',\n        displayName: 'Read',\n        uid: 'explorer.read',\n        pluginName: 'content-manager',\n        subjects: contentTypesUids,\n        options: {\n          applyToProperties: ['fields'],\n        },\n      },\n      {\n        section: 'contentTypes',\n        displayName: 'Update',\n        uid: 'explorer.update',\n        pluginName: 'content-manager',\n        subjects: contentTypesUids,\n        options: {\n          applyToProperties: ['fields'],\n        },\n      },\n      {\n        section: 'contentTypes',\n        displayName: 'Delete',\n        uid: 'explorer.delete',\n        pluginName: 'content-manager',\n        subjects: contentTypesUids,\n      },\n      {\n        section: 'contentTypes',\n        displayName: 'Publish',\n        uid: 'explorer.publish',\n        pluginName: 'content-manager',\n        subjects: contentTypesUids,\n      },\n      {\n        section: 'plugins',\n        displayName: 'Configure view',\n        uid: 'single-types.configure-view',\n        subCategory: 'single types',\n        pluginName: 'content-manager',\n      },\n      {\n        section: 'plugins',\n        displayName: 'Configure view',\n        uid: 'collection-types.configure-view',\n        subCategory: 'collection types',\n        pluginName: 'content-manager',\n      },\n      {\n        section: 'plugins',\n        displayName: 'Configure Layout',\n        uid: 'components.configure-layout',\n        subCategory: 'components',\n        pluginName: 'content-manager',\n      },\n    ];\n\n    await strapi.service('admin::permission').actionProvider.registerMany(actions);\n  },\n});\n"],"names":["strapi","canConfigureContentType","userAbility","contentType","action","contentTypesUtils","isSingleType","can","registerPermissions","displayedContentTypes","getService","findDisplayedContentTypes","contentTypesUids","map","prop","actions","section","displayName","uid","pluginName","subjects","options","applyToProperties","subCategory","service","actionProvider","registerMany"],"mappings":";;;;AAMA,iBAAe,CAAA,CAAC,EAAEA,MAAM,EAA2B,IAAM;AACvDC,QAAAA,uBAAAA,CAAAA,CAAwB,EACtBC,WAAW,EACXC,WAAW,EAIZ,EAAA;AACC,YAAA,MAAMC,MAASC,GAAAA,YAAAA,CAAkBC,YAAY,CAACH,eAC1C,qDACA,GAAA,yDAAA;YAEJ,OAAOD,WAAAA,CAAYK,GAAG,CAACH,MAAAA,CAAAA;AACzB,SAAA;QAEA,MAAMI,mBAAAA,CAAAA,GAAAA;YACJ,MAAMC,qBAAAA,GAAwBC,UAAW,CAAA,eAAA,CAAA,CAAiBC,yBAAyB,EAAA;AACnF,YAAA,MAAMC,gBAAmBH,GAAAA,qBAAAA,CAAsBI,GAAG,CAACC,IAAK,CAAA,KAAA,CAAA,CAAA;AAExD,YAAA,MAAMC,OAAU,GAAA;AACd,gBAAA;oBACEC,OAAS,EAAA,cAAA;oBACTC,WAAa,EAAA,QAAA;oBACbC,GAAK,EAAA,iBAAA;oBACLC,UAAY,EAAA,iBAAA;oBACZC,QAAUR,EAAAA,gBAAAA;oBACVS,OAAS,EAAA;wBACPC,iBAAmB,EAAA;AAAC,4BAAA;AAAS;AAC/B;AACF,iBAAA;AACA,gBAAA;oBACEN,OAAS,EAAA,cAAA;oBACTC,WAAa,EAAA,MAAA;oBACbC,GAAK,EAAA,eAAA;oBACLC,UAAY,EAAA,iBAAA;oBACZC,QAAUR,EAAAA,gBAAAA;oBACVS,OAAS,EAAA;wBACPC,iBAAmB,EAAA;AAAC,4BAAA;AAAS;AAC/B;AACF,iBAAA;AACA,gBAAA;oBACEN,OAAS,EAAA,cAAA;oBACTC,WAAa,EAAA,QAAA;oBACbC,GAAK,EAAA,iBAAA;oBACLC,UAAY,EAAA,iBAAA;oBACZC,QAAUR,EAAAA,gBAAAA;oBACVS,OAAS,EAAA;wBACPC,iBAAmB,EAAA;AAAC,4BAAA;AAAS;AAC/B;AACF,iBAAA;AACA,gBAAA;oBACEN,OAAS,EAAA,cAAA;oBACTC,WAAa,EAAA,QAAA;oBACbC,GAAK,EAAA,iBAAA;oBACLC,UAAY,EAAA,iBAAA;oBACZC,QAAUR,EAAAA;AACZ,iBAAA;AACA,gBAAA;oBACEI,OAAS,EAAA,cAAA;oBACTC,WAAa,EAAA,SAAA;oBACbC,GAAK,EAAA,kBAAA;oBACLC,UAAY,EAAA,iBAAA;oBACZC,QAAUR,EAAAA;AACZ,iBAAA;AACA,gBAAA;oBACEI,OAAS,EAAA,SAAA;oBACTC,WAAa,EAAA,gBAAA;oBACbC,GAAK,EAAA,6BAAA;oBACLK,WAAa,EAAA,cAAA;oBACbJ,UAAY,EAAA;AACd,iBAAA;AACA,gBAAA;oBACEH,OAAS,EAAA,SAAA;oBACTC,WAAa,EAAA,gBAAA;oBACbC,GAAK,EAAA,iCAAA;oBACLK,WAAa,EAAA,kBAAA;oBACbJ,UAAY,EAAA;AACd,iBAAA;AACA,gBAAA;oBACEH,OAAS,EAAA,SAAA;oBACTC,WAAa,EAAA,kBAAA;oBACbC,GAAK,EAAA,6BAAA;oBACLK,WAAa,EAAA,YAAA;oBACbJ,UAAY,EAAA;AACd;AACD,aAAA;AAED,YAAA,MAAMnB,OAAOwB,OAAO,CAAC,qBAAqBC,cAAc,CAACC,YAAY,CAACX,OAAAA,CAAAA;AACxE;AACF,KAAA,CAAC;;;;"}