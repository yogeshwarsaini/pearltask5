{"version":3,"file":"metrics.mjs","sources":["../../../server/src/services/metrics.ts"],"sourcesContent":["import { intersection, prop } from 'lodash/fp';\nimport { relations } from '@strapi/utils';\nimport type { Core, Struct } from '@strapi/types';\nimport type { Configuration } from '../../../shared/contracts/content-types';\n\nconst { getRelationalFields } = relations;\n\nexport default ({ strapi }: { strapi: Core.Strapi }) => {\n  const sendDidConfigureListView = async (\n    contentType: Struct.ContentTypeSchema,\n    configuration: Configuration\n  ) => {\n    const displayedFields = prop('length', configuration.layouts.list);\n    const relationalFields = getRelationalFields(contentType);\n    const displayedRelationalFields = intersection(\n      relationalFields,\n      configuration.layouts.list\n    ).length;\n\n    const data = {\n      eventProperties: { containsRelationalFields: !!displayedRelationalFields },\n    };\n\n    if (data.eventProperties.containsRelationalFields) {\n      Object.assign(data.eventProperties, {\n        displayedFields,\n        displayedRelationalFields,\n      });\n    }\n\n    try {\n      await strapi.telemetry.send('didConfigureListView', data);\n    } catch (e) {\n      // silence\n    }\n  };\n\n  return {\n    sendDidConfigureListView,\n  };\n};\n"],"names":["getRelationalFields","relations","strapi","sendDidConfigureListView","contentType","configuration","displayedFields","prop","layouts","list","relationalFields","displayedRelationalFields","intersection","length","data","eventProperties","containsRelationalFields","Object","assign","telemetry","send","e"],"mappings":";;;AAKA,MAAM,EAAEA,mBAAmB,EAAE,GAAGC,SAAAA;AAEhC,cAAe,CAAA,CAAC,EAAEC,MAAM,EAA2B,GAAA;IACjD,MAAMC,wBAAAA,GAA2B,OAC/BC,WACAC,EAAAA,aAAAA,GAAAA;AAEA,QAAA,MAAMC,kBAAkBC,IAAK,CAAA,QAAA,EAAUF,aAAcG,CAAAA,OAAO,CAACC,IAAI,CAAA;AACjE,QAAA,MAAMC,mBAAmBV,mBAAoBI,CAAAA,WAAAA,CAAAA;QAC7C,MAAMO,yBAAAA,GAA4BC,aAChCF,gBACAL,EAAAA,aAAAA,CAAcG,OAAO,CAACC,IAAI,EAC1BI,MAAM;AAER,QAAA,MAAMC,IAAO,GAAA;YACXC,eAAiB,EAAA;AAAEC,gBAAAA,wBAAAA,EAA0B,CAAC,CAACL;AAA0B;AAC3E,SAAA;AAEA,QAAA,IAAIG,IAAKC,CAAAA,eAAe,CAACC,wBAAwB,EAAE;AACjDC,YAAAA,MAAAA,CAAOC,MAAM,CAACJ,IAAKC,CAAAA,eAAe,EAAE;AAClCT,gBAAAA,eAAAA;AACAK,gBAAAA;AACF,aAAA,CAAA;AACF;QAEA,IAAI;AACF,YAAA,MAAMT,MAAOiB,CAAAA,SAAS,CAACC,IAAI,CAAC,sBAAwBN,EAAAA,IAAAA,CAAAA;AACtD,SAAA,CAAE,OAAOO,CAAG,EAAA;;AAEZ;AACF,KAAA;IAEA,OAAO;AACLlB,QAAAA;AACF,KAAA;AACF,CAAA;;;;"}