{"version":3,"file":"build.mjs","sources":["../../../../src/node/webpack/build.ts"],"sourcesContent":["import webpack from 'webpack';\n\nimport { mergeConfigWithUserConfig, resolveProductionConfig } from './config';\nimport { isError } from '../core/errors';\n\nimport type { BuildContext } from '../create-build-context';\n\nconst build = async (ctx: BuildContext) => {\n  const config = await resolveProductionConfig(ctx);\n  const finalConfig = await mergeConfigWithUserConfig(config, ctx);\n\n  ctx.logger.debug('Webpack config', finalConfig);\n\n  return new Promise((resolve, reject) => {\n    webpack(finalConfig, (err, stats) => {\n      if (stats) {\n        if (stats.hasErrors()) {\n          ctx.logger.error(\n            stats.toString({\n              chunks: false,\n              colors: true,\n            })\n          );\n\n          reject();\n        } else if (ctx.options.stats) {\n          ctx.logger.info(\n            stats.toString({\n              chunks: false,\n              colors: true,\n            })\n          );\n        }\n\n        resolve(true);\n      }\n\n      if (err && isError(err)) {\n        ctx.logger.error(err.message);\n        reject();\n      }\n    });\n  });\n};\n\nexport { build };\n"],"names":["build","ctx","config","resolveProductionConfig","finalConfig","mergeConfigWithUserConfig","logger","debug","Promise","resolve","reject","webpack","err","stats","hasErrors","error","toString","chunks","colors","options","info","isError","message"],"mappings":";;;;AAOA,MAAMA,QAAQ,OAAOC,GAAAA,GAAAA;IACnB,MAAMC,MAAAA,GAAS,MAAMC,uBAAwBF,CAAAA,GAAAA,CAAAA;IAC7C,MAAMG,WAAAA,GAAc,MAAMC,yBAAAA,CAA0BH,MAAQD,EAAAA,GAAAA,CAAAA;AAE5DA,IAAAA,GAAAA,CAAIK,MAAM,CAACC,KAAK,CAAC,gBAAkBH,EAAAA,WAAAA,CAAAA;IAEnC,OAAO,IAAII,OAAQ,CAAA,CAACC,OAASC,EAAAA,MAAAA,GAAAA;QAC3BC,OAAQP,CAAAA,WAAAA,EAAa,CAACQ,GAAKC,EAAAA,KAAAA,GAAAA;AACzB,YAAA,IAAIA,KAAO,EAAA;gBACT,IAAIA,KAAAA,CAAMC,SAAS,EAAI,EAAA;AACrBb,oBAAAA,GAAAA,CAAIK,MAAM,CAACS,KAAK,CACdF,KAAAA,CAAMG,QAAQ,CAAC;wBACbC,MAAQ,EAAA,KAAA;wBACRC,MAAQ,EAAA;AACV,qBAAA,CAAA,CAAA;AAGFR,oBAAAA,MAAAA,EAAAA;AACF,iBAAA,MAAO,IAAIT,GAAAA,CAAIkB,OAAO,CAACN,KAAK,EAAE;AAC5BZ,oBAAAA,GAAAA,CAAIK,MAAM,CAACc,IAAI,CACbP,KAAAA,CAAMG,QAAQ,CAAC;wBACbC,MAAQ,EAAA,KAAA;wBACRC,MAAQ,EAAA;AACV,qBAAA,CAAA,CAAA;AAEJ;gBAEAT,OAAQ,CAAA,IAAA,CAAA;AACV;YAEA,IAAIG,GAAAA,IAAOS,QAAQT,GAAM,CAAA,EAAA;AACvBX,gBAAAA,GAAAA,CAAIK,MAAM,CAACS,KAAK,CAACH,IAAIU,OAAO,CAAA;AAC5BZ,gBAAAA,MAAAA,EAAAA;AACF;AACF,SAAA,CAAA;AACF,KAAA,CAAA;AACF;;;;"}