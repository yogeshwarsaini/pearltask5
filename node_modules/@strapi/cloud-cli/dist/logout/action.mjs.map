{"version":3,"file":"action.mjs","sources":["../../src/logout/action.ts"],"sourcesContent":["import type { CLIContext } from '../types';\nimport { tokenServiceFactory, cloudApiFactory } from '../services';\nimport { trackEvent } from '../utils/analytics';\n\nconst openModule = import('open');\n\nexport default async (ctx: CLIContext) => {\n  const { logger } = ctx;\n  const { retrieveToken, eraseToken } = await tokenServiceFactory(ctx);\n\n  const token = await retrieveToken();\n  if (!token) {\n    logger.log(\"You're already logged out.\");\n    return;\n  }\n  const cloudApiService = await cloudApiFactory(ctx, token);\n  const config = await cloudApiService.config();\n  const cliConfig = config.data;\n\n  try {\n    await eraseToken();\n\n    openModule.then((open) => {\n      open\n        .default(\n          `${cliConfig.baseUrl}/oidc/logout?client_id=${encodeURIComponent(\n            cliConfig.clientId\n          )}&logout_hint=${encodeURIComponent(token)}\n          `\n        )\n        .catch((e: Error) => {\n          // Failing to open the logout URL is not a critical error, so we just log it\n          logger.debug(e.message, e);\n        });\n    });\n\n    logger.log(\n      'ðŸ”Œ You have been logged out from the CLI. If you are on a shared computer, please make sure to log out from the Strapi Cloud Dashboard as well.'\n    );\n  } catch (e) {\n    logger.error('ðŸ¥² Oops! Something went wrong while logging you out. Please try again.');\n    logger.debug(e);\n  }\n  await trackEvent(ctx, cloudApiService, 'didLogout', { loginMethod: 'cli' });\n};\n"],"names":["openModule","ctx","logger","retrieveToken","eraseToken","tokenServiceFactory","token","log","cloudApiService","cloudApiFactory","config","cliConfig","data","then","open","default","baseUrl","encodeURIComponent","clientId","catch","e","debug","message","error","trackEvent","loginMethod"],"mappings":";;;;;;;;;;;AAIA,MAAMA,UAAAA,GAAa,OAAO,MAAA,CAAA;AAE1B,aAAe,CAAA,OAAOC,GAAAA,GAAAA;IACpB,MAAM,EAAEC,MAAM,EAAE,GAAGD,GAAAA;AACnB,IAAA,MAAM,EAAEE,aAAa,EAAEC,UAAU,EAAE,GAAG,MAAMC,mBAAoBJ,CAAAA,GAAAA,CAAAA;AAEhE,IAAA,MAAMK,QAAQ,MAAMH,aAAAA,EAAAA;AACpB,IAAA,IAAI,CAACG,KAAO,EAAA;AACVJ,QAAAA,MAAAA,CAAOK,GAAG,CAAC,4BAAA,CAAA;AACX,QAAA;AACF;IACA,MAAMC,eAAAA,GAAkB,MAAMC,eAAAA,CAAgBR,GAAKK,EAAAA,KAAAA,CAAAA;IACnD,MAAMI,MAAAA,GAAS,MAAMF,eAAAA,CAAgBE,MAAM,EAAA;IAC3C,MAAMC,SAAAA,GAAYD,OAAOE,IAAI;IAE7B,IAAI;QACF,MAAMR,UAAAA,EAAAA;QAENJ,UAAWa,CAAAA,IAAI,CAAC,CAACC,IAAAA,GAAAA;AACfA,YAAAA,IAAAA,CACGC,OAAO,CACN,CAAC,EAAEJ,SAAAA,CAAUK,OAAO,CAAC,uBAAuB,EAAEC,kBAAAA,CAC5CN,UAAUO,QAAQ,CAAA,CAClB,aAAa,EAAED,mBAAmBX,KAAO,CAAA;UAC3C,CAAC,CAAA,CAEFa,KAAK,CAAC,CAACC,CAAAA,GAAAA;;AAENlB,gBAAAA,MAAAA,CAAOmB,KAAK,CAACD,CAAEE,CAAAA,OAAO,EAAEF,CAAAA,CAAAA;AAC1B,aAAA,CAAA;AACJ,SAAA,CAAA;AAEAlB,QAAAA,MAAAA,CAAOK,GAAG,CACR,iJAAA,CAAA;AAEJ,KAAA,CAAE,OAAOa,CAAG,EAAA;AACVlB,QAAAA,MAAAA,CAAOqB,KAAK,CAAC,wEAAA,CAAA;AACbrB,QAAAA,MAAAA,CAAOmB,KAAK,CAACD,CAAAA,CAAAA;AACf;IACA,MAAMI,UAAAA,CAAWvB,GAAKO,EAAAA,eAAAA,EAAiB,WAAa,EAAA;QAAEiB,WAAa,EAAA;AAAM,KAAA,CAAA;AAC3E,CAAA;;;;"}