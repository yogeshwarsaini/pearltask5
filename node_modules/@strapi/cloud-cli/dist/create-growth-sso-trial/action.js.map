{"version":3,"file":"action.js","sources":["../../src/create-growth-sso-trial/action.ts"],"sourcesContent":["import { cloudApiFactory, tokenServiceFactory } from '../services';\nimport { createLogger } from '../services/logger';\nimport { trackEvent } from '../utils/analytics';\n\ninterface CreateGrowthSsoTrialInput {\n  strapiVersion: string | undefined;\n}\n\ninterface CreateGrowthSsoTrialResponse {\n  license: string;\n}\n\nexport default async ({\n  strapiVersion,\n}: CreateGrowthSsoTrialInput): Promise<CreateGrowthSsoTrialResponse | undefined> => {\n  const logger = createLogger();\n  const { retrieveToken } = await tokenServiceFactory({ logger });\n\n  const token = await retrieveToken();\n  if (!token) {\n    return;\n  }\n\n  const cloudApiService = await cloudApiFactory({ logger }, token);\n\n  try {\n    const { data: config } = await cloudApiService.config();\n    if (!config?.featureFlags?.growthSsoTrialEnabled) {\n      return;\n    }\n  } catch (e: unknown) {\n    logger.debug('Failed to get cli config', e);\n    return;\n  }\n\n  try {\n    const response = await cloudApiService.createTrial({ strapiVersion: strapiVersion || '' });\n\n    await trackEvent({ logger, cwd: process.cwd() }, cloudApiService, 'didCreateGrowthSsoTrial', {\n      strapiVersion: strapiVersion || '',\n    });\n\n    return { license: response.data?.licenseKey };\n  } catch (e: Error | unknown) {\n    logger.debug(e);\n    logger.error(\n      'We encountered an issue while creating your trial. Please try again in a moment. If the problem persists, contact support for assistance.'\n    );\n  }\n};\n"],"names":["strapiVersion","logger","createLogger","retrieveToken","tokenServiceFactory","token","cloudApiService","cloudApiFactory","data","config","featureFlags","growthSsoTrialEnabled","e","debug","response","createTrial","trackEvent","cwd","process","license","licenseKey","error"],"mappings":";;;;;;;;;;AAYA,aAAe,CAAA,OAAO,EACpBA,aAAa,EACa,GAAA;AAC1B,IAAA,MAAMC,QAASC,GAAAA,mBAAAA,EAAAA;AACf,IAAA,MAAM,EAAEC,aAAa,EAAE,GAAG,MAAMC,yBAAoB,CAAA;AAAEH,gBAAAA;AAAO,KAAA,CAAA;AAE7D,IAAA,MAAMI,UAAQ,MAAMF,aAAAA,EAAAA;AACpB,IAAA,IAAI,CAACE,OAAO,EAAA;AACV,QAAA;AACF;IAEA,MAAMC,eAAAA,GAAkB,MAAMC,sBAAgB,CAAA;AAAEN,gBAAAA;KAAUI,EAAAA,OAAAA,CAAAA;IAE1D,IAAI;AACF,QAAA,MAAM,EAAEG,IAAMC,EAAAA,MAAM,EAAE,GAAG,MAAMH,gBAAgBG,MAAM,EAAA;QACrD,IAAI,CAACA,MAAQC,EAAAA,YAAAA,EAAcC,qBAAuB,EAAA;AAChD,YAAA;AACF;AACF,KAAA,CAAE,OAAOC,CAAY,EAAA;QACnBX,QAAOY,CAAAA,KAAK,CAAC,0BAA4BD,EAAAA,CAAAA,CAAAA;AACzC,QAAA;AACF;IAEA,IAAI;AACF,QAAA,MAAME,QAAW,GAAA,MAAMR,eAAgBS,CAAAA,WAAW,CAAC;AAAEf,YAAAA,aAAAA,EAAeA,aAAiB,IAAA;AAAG,SAAA,CAAA;AAExF,QAAA,MAAMgB,oBAAW,CAAA;AAAEf,oBAAAA,QAAAA;AAAQgB,YAAAA,GAAAA,EAAKC,QAAQD,GAAG;AAAG,SAAA,EAAGX,iBAAiB,yBAA2B,EAAA;AAC3FN,YAAAA,aAAAA,EAAeA,aAAiB,IAAA;AAClC,SAAA,CAAA;QAEA,OAAO;YAAEmB,OAASL,EAAAA,QAAAA,CAASN,IAAI,EAAEY;AAAW,SAAA;AAC9C,KAAA,CAAE,OAAOR,CAAoB,EAAA;AAC3BX,QAAAA,QAAAA,CAAOY,KAAK,CAACD,CAAAA,CAAAA;AACbX,QAAAA,QAAAA,CAAOoB,KAAK,CACV,2IAAA,CAAA;AAEJ;AACF,CAAA;;;;"}