{"version":3,"file":"public.mjs","sources":["../../src/middlewares/public.ts"],"sourcesContent":["import { defaultsDeep } from 'lodash/fp';\nimport koaStatic from 'koa-static';\nimport type { Core } from '@strapi/types';\n\ntype Config = koaStatic.Options;\n\nconst defaults = {\n  maxAge: 60000,\n};\n\nexport const publicStatic: Core.MiddlewareFactory = (\n  config: Config,\n  { strapi }: { strapi: Core.Strapi }\n) => {\n  const { maxAge } = defaultsDeep(defaults, config);\n\n  strapi.server.routes([\n    {\n      method: 'GET',\n      path: '/',\n      handler(ctx) {\n        ctx.redirect(strapi.config.get('admin.url', '/admin'));\n      },\n      config: { auth: false },\n    },\n    // All other public GET-routes except /uploads/(.*) which is handled in upload middleware\n    {\n      method: 'GET',\n      path: '/((?!uploads/).+)',\n      handler: koaStatic(strapi.dirs.static.public, {\n        maxage: maxAge,\n        defer: true,\n      }),\n      config: { auth: false },\n    },\n  ]);\n};\n"],"names":["defaults","maxAge","publicStatic","config","strapi","defaultsDeep","server","routes","method","path","handler","ctx","redirect","get","auth","koaStatic","dirs","static","public","maxage","defer"],"mappings":";;;AAMA,MAAMA,QAAW,GAAA;IACfC,MAAQ,EAAA;AACV,CAAA;MAEaC,YAAuC,GAAA,CAClDC,MACA,EAAA,EAAEC,MAAM,EAA2B,GAAA;AAEnC,IAAA,MAAM,EAAEH,MAAM,EAAE,GAAGI,aAAaL,QAAUG,EAAAA,MAAAA,CAAAA;IAE1CC,MAAOE,CAAAA,MAAM,CAACC,MAAM,CAAC;AACnB,QAAA;YACEC,MAAQ,EAAA,KAAA;YACRC,IAAM,EAAA,GAAA;AACNC,YAAAA,OAAAA,CAAAA,CAAQC,GAAG,EAAA;AACTA,gBAAAA,GAAAA,CAAIC,QAAQ,CAACR,MAAAA,CAAOD,MAAM,CAACU,GAAG,CAAC,WAAa,EAAA,QAAA,CAAA,CAAA;AAC9C,aAAA;YACAV,MAAQ,EAAA;gBAAEW,IAAM,EAAA;AAAM;AACxB,SAAA;;AAEA,QAAA;YACEN,MAAQ,EAAA,KAAA;YACRC,IAAM,EAAA,mBAAA;AACNC,YAAAA,OAAAA,EAASK,UAAUX,MAAOY,CAAAA,IAAI,CAACC,MAAM,CAACC,MAAM,EAAE;gBAC5CC,MAAQlB,EAAAA,MAAAA;gBACRmB,KAAO,EAAA;AACT,aAAA,CAAA;YACAjB,MAAQ,EAAA;gBAAEW,IAAM,EAAA;AAAM;AACxB;AACD,KAAA,CAAA;AACH;;;;"}