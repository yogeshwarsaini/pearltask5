{"version":3,"file":"errors.mjs","sources":["../../src/middlewares/errors.ts"],"sourcesContent":["import { errors } from '@strapi/utils';\nimport type { Core } from '@strapi/types';\n\nimport { formatApplicationError, formatHttpError, formatInternalError } from '../services/errors';\n\nconst errorMiddleware: Core.MiddlewareFactory = (/* _, { strapi } */) => {\n  return async (ctx, next) => {\n    try {\n      await next();\n\n      if (!ctx.response._explicitStatus) {\n        return ctx.notFound();\n      }\n    } catch (error) {\n      if (error instanceof errors.ApplicationError) {\n        const { status, body } = formatApplicationError(error);\n        ctx.status = status;\n        ctx.body = body;\n        return;\n      }\n\n      if (error instanceof errors.HttpError) {\n        const { status, body } = formatHttpError(error);\n        ctx.status = status;\n        ctx.body = body;\n        return;\n      }\n\n      strapi.log.error(error);\n\n      const { status, body } = formatInternalError(error);\n      ctx.status = status;\n      ctx.body = body;\n    }\n  };\n};\n\nexport { errorMiddleware as errors };\n"],"names":["errorMiddleware","ctx","next","response","_explicitStatus","notFound","error","errors","ApplicationError","status","body","formatApplicationError","HttpError","formatHttpError","strapi","log","formatInternalError"],"mappings":";;;AAKA,MAAMA,eAA0C,GAAA,IAAA;AAC9C,IAAA,OAAO,OAAOC,GAAKC,EAAAA,IAAAA,GAAAA;QACjB,IAAI;YACF,MAAMA,IAAAA,EAAAA;AAEN,YAAA,IAAI,CAACD,GAAAA,CAAIE,QAAQ,CAACC,eAAe,EAAE;AACjC,gBAAA,OAAOH,IAAII,QAAQ,EAAA;AACrB;AACF,SAAA,CAAE,OAAOC,KAAO,EAAA;YACd,IAAIA,KAAAA,YAAiBC,MAAOC,CAAAA,gBAAgB,EAAE;AAC5C,gBAAA,MAAM,EAAEC,MAAM,EAAEC,IAAI,EAAE,GAAGC,sBAAuBL,CAAAA,KAAAA,CAAAA;AAChDL,gBAAAA,GAAAA,CAAIQ,MAAM,GAAGA,MAAAA;AACbR,gBAAAA,GAAAA,CAAIS,IAAI,GAAGA,IAAAA;AACX,gBAAA;AACF;YAEA,IAAIJ,KAAAA,YAAiBC,MAAOK,CAAAA,SAAS,EAAE;AACrC,gBAAA,MAAM,EAAEH,MAAM,EAAEC,IAAI,EAAE,GAAGG,eAAgBP,CAAAA,KAAAA,CAAAA;AACzCL,gBAAAA,GAAAA,CAAIQ,MAAM,GAAGA,MAAAA;AACbR,gBAAAA,GAAAA,CAAIS,IAAI,GAAGA,IAAAA;AACX,gBAAA;AACF;YAEAI,MAAOC,CAAAA,GAAG,CAACT,KAAK,CAACA,KAAAA,CAAAA;AAEjB,YAAA,MAAM,EAAEG,MAAM,EAAEC,IAAI,EAAE,GAAGM,mBAAoBV,CAAAA,KAAAA,CAAAA;AAC7CL,YAAAA,GAAAA,CAAIQ,MAAM,GAAGA,MAAAA;AACbR,YAAAA,GAAAA,CAAIS,IAAI,GAAGA,IAAAA;AACb;AACF,KAAA;AACF;;;;"}