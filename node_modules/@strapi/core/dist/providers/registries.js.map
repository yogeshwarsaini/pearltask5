{"version":3,"file":"registries.js","sources":["../../src/providers/registries.ts"],"sourcesContent":["import { hooks } from '@strapi/utils';\n\nimport { defineProvider } from './provider';\nimport * as registries from '../registries';\nimport { loadApplicationContext } from '../loaders';\nimport * as syncMigrations from '../migrations';\nimport { discardDocumentDrafts } from '../migrations/database/5.0.0-discard-drafts';\n\nexport default defineProvider({\n  init(strapi) {\n    strapi\n      .add('content-types', () => registries.contentTypes())\n      .add('components', () => registries.components())\n      .add('services', () => registries.services(strapi))\n      .add('policies', () => registries.policies())\n      .add('middlewares', () => registries.middlewares())\n      .add('hooks', () => registries.hooks())\n      .add('controllers', () => registries.controllers(strapi))\n      .add('modules', () => registries.modules(strapi))\n      .add('plugins', () => registries.plugins(strapi))\n      .add('custom-fields', () => registries.customFields(strapi))\n      .add('apis', () => registries.apis(strapi))\n      .add('models', () => registries.models())\n      .add('sanitizers', registries.sanitizers())\n      .add('validators', registries.validators());\n  },\n  async register(strapi) {\n    await loadApplicationContext(strapi);\n\n    strapi.get('hooks').set('strapi::content-types.beforeSync', hooks.createAsyncParallelHook());\n    strapi.get('hooks').set('strapi::content-types.afterSync', hooks.createAsyncParallelHook());\n\n    // Content migration to enable draft and publish\n    strapi.hook('strapi::content-types.beforeSync').register(syncMigrations.disable);\n    strapi.hook('strapi::content-types.afterSync').register(syncMigrations.enable);\n\n    // Database migrations\n    strapi.db.migrations.providers.internal.register(discardDocumentDrafts);\n  },\n});\n"],"names":["defineProvider","init","strapi","add","registries","register","loadApplicationContext","get","set","hooks","createAsyncParallelHook","hook","syncMigrations","db","migrations","providers","internal","discardDocumentDrafts"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAQA,iBAAeA,uBAAe,CAAA;AAC5BC,IAAAA,IAAAA,CAAAA,CAAKC,MAAM,EAAA;QACTA,MACGC,CAAAA,GAAG,CAAC,eAAiB,EAAA,IAAMC,YAAuB,EAAA,CAAA,CAClDD,GAAG,CAAC,YAAc,EAAA,IAAMC,UAAqB,EAAA,CAAA,CAC7CD,GAAG,CAAC,UAAA,EAAY,IAAMC,QAAmB,CAACF,MAAAA,CAAAA,CAAAA,CAC1CC,GAAG,CAAC,YAAY,IAAMC,QAAmB,EACzCD,CAAAA,CAAAA,GAAG,CAAC,aAAe,EAAA,IAAMC,WAAsB,EAC/CD,CAAAA,CAAAA,GAAG,CAAC,OAAS,EAAA,IAAMC,KAAgB,EAAA,CAAA,CACnCD,GAAG,CAAC,aAAA,EAAe,IAAMC,WAAsB,CAACF,SAChDC,GAAG,CAAC,WAAW,IAAMC,OAAkB,CAACF,MAAAA,CAAAA,CAAAA,CACxCC,GAAG,CAAC,SAAW,EAAA,IAAMC,OAAkB,CAACF,SACxCC,GAAG,CAAC,iBAAiB,IAAMC,YAAuB,CAACF,MACnDC,CAAAA,CAAAA,CAAAA,GAAG,CAAC,MAAQ,EAAA,IAAMC,IAAe,CAACF,SAClCC,GAAG,CAAC,QAAU,EAAA,IAAMC,eAAiB,IACrCD,GAAG,CAAC,cAAcC,UAAqB,IACvCD,GAAG,CAAC,YAAcC,EAAAA,UAAqB,EAAA,CAAA;AAC5C,KAAA;AACA,IAAA,MAAMC,UAASH,MAAM,EAAA;AACnB,QAAA,MAAMI,4BAAuBJ,CAAAA,MAAAA,CAAAA;AAE7BA,QAAAA,MAAAA,CAAOK,GAAG,CAAC,OAAA,CAAA,CAASC,GAAG,CAAC,kCAAA,EAAoCC,kBAAMC,uBAAuB,EAAA,CAAA;AACzFR,QAAAA,MAAAA,CAAOK,GAAG,CAAC,OAAA,CAAA,CAASC,GAAG,CAAC,iCAAA,EAAmCC,kBAAMC,uBAAuB,EAAA,CAAA;;AAGxFR,QAAAA,MAAAA,CAAOS,IAAI,CAAC,kCAAA,CAAA,CAAoCN,QAAQ,CAACO,eAAsB,CAAA;AAC/EV,QAAAA,MAAAA,CAAOS,IAAI,CAAC,iCAAA,CAAA,CAAmCN,QAAQ,CAACO,cAAqB,CAAA;;QAG7EV,MAAOW,CAAAA,EAAE,CAACC,UAAU,CAACC,SAAS,CAACC,QAAQ,CAACX,QAAQ,CAACY,yCAAAA,CAAAA;AACnD;AACF,CAAG,CAAA;;;;"}